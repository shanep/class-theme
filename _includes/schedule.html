
{% assign pgs = site.lessons | sort: 'slug' %}

{% assign tableFileParam = {{include.file}} %}
{% assign tableFile = site.data[tableFileParam] %}

{% assign one_day = 1 | times: 24 | times: 60 | times: 60 %}
{% assign two_days = 2 | times: 24 | times: 60 | times: 60 %}
{% assign three_days = 3 | times: 24 | times: 60 | times: 60 %}
{% assign four_days = 4 | times: 24 | times: 60 | times: 60 %}

{% if tableFile.start-day == "monday" %}
  {% assign curr_date = tableFile.start-date | date: "%s" | minus: four_days%}
{% elsif tableFile.start-day == "tuesday" %}
  {% assign curr_date = tableFile.start-date | date: "%s" | minus: three_days%}
{% elsif tableFile.start-day == "wednesday" %}
  {% assign curr_date = tableFile.start-date | date: "%s" | minus: two_days%}
{% elsif tableFile.start-day == "thursday" %}
  {% assign curr_date = tableFile.start-date | date: "%s" | minus: one_day %}
{% endif%}

<div >
  
  <h2 id="important-links">Important links</h2>
  <ul>
    <li><a href="{{tableFile.textbook}}">Text Book</a></li>
    <li><a href="{{tableFile.discussion}}">Discussion Forum</a></li>
    <li><a href="{{tableFile.github}}">Github Classroom</a></li>
    <li><a href="{{tableFile.office-hours}}">Office Hours</a></li>
    <li><a href="{{tableFile.grades}}">Grades</a></li>
    <li><a href="{{tableFile.exams}}">Midterm and Final exams</a></li>
    <li><a href="{{tableFile.example-exams}}">Practice exams</a></li>
  </ul>

  <h2 id="schedule">Schedule - {{tableFile.semester}}</h2>
  <table style="margin:auto;height: 100%; width: 100%;">
    <thead>
      <tr>
        <th class="text-center">Week</th>
        <th>Due Date</th>
        <th>Lesson</th>
      </tr>
    </thead>

    <tbody>
      {% assign curr_week = 1 %}
      {% assign curr_module = "none" %}

      {% assign loop_counter = 1 %}

      {% for page in pgs %}
        {% if page.path contains "lesson"  %}
          {% assign loop_counter = loop_counter | plus: 1 %}
          {% if curr_module != page.tag %}
          <!--Module header-->
            <tr>
              <td colspan="3" class="text-center table-darkish">{{page.tag | capitalize }}</td>
            </tr>
            {% assign curr_module = page.tag %}
          {% endif%}


          {% if curr_week == tableFile.break %}
            <!--Add in the break week, we need to grab the next lesson before inserting new week-->
            <tr>
              {% assign curr_date = curr_date | date: %s | plus: two_days %}
              <td>{{curr_date | date: "%m/%d - %a"}}</td>
              <td><a href="{{site.url}}{{page.url}}">{{page.title}} ({{page.slug}})</a>{%if page.layout == "lab"%} ðŸ§ª {%elsif page.layout == "project" %} ðŸ“¡ {% endif%}</td>
            </tr>
            <tr>
              <td rowspan= 2 class="table-lightish text-center border">
                {% assign curr_date = curr_date | date: %s | plus: three_days %}
                {{curr_week}}  
              </td>
              {% assign curr_date = curr_date | date: %s | plus: two_days %}
              <td>{{curr_date | date: "%m/%d - %a"}}</td>
              <td>Break</td>
            </tr>
            <tr>
              {% assign curr_date = curr_date | date: %s | plus: two_days %}
              <td>{{curr_date | date: "%m/%d - %a"}}</td>
              <td>Break</td>
            </tr>
            {% assign curr_week = curr_week | plus: 1 %}
          {%else%}

          <tr>
            {% comment %} 
            Need to keep track of our own loop counter to filter out docs don't use forloop.index
            {% endcomment %}
            {% assign tmp = loop_counter | modulo: 2 %}
            {% if tmp == 0 %}        
            <td rowspan= 2 class="table-lightish text-center border">
              {% assign curr_date = curr_date | date: %s | plus: three_days %}
              {{curr_week}}          
              {% assign curr_week = curr_week | plus: 1 %}
            </td>       
            {% endif %}
            {% assign curr_date = curr_date | date: %s | plus: two_days %}
            <td>{{curr_date | date: "%m/%d - %a"}}</td>
            
            
            <td><a href="{{site.url}}{{page.url}}">{{page.title}} ({{page.slug}})</a>{%if page.layout == "lab"%} ðŸ§ª {%elsif page.layout == "project" %} ðŸ“¡ {% endif%}</td>
          </tr>
          {%endif%}
        {% endif %}  
      {% endfor%}
    </tbody>
  </table>
</div>